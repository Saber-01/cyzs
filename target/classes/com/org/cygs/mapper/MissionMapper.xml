<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.org.cygs.dao.MissionDao" >
  <resultMap id="MissionMap" type="com.org.cygs.pojo.Mission" >
    <id column="M_ID" property="mId" jdbcType="VARCHAR" />
    <result column="BEGIN_DATE" property="beginDate" jdbcType="TIMESTAMP" />
    <result column="END_DATE" property="endDate" jdbcType="TIMESTAMP" />
    <result column="M_CODE" property="mCode" jdbcType="VARCHAR" />
    <result column="SUBMIT_TIME" property="submitTime" jdbcType="TIMESTAMP" />
    <result column="STATUS" property="status" jdbcType="INTEGER" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="EDTION_ID" property="edtionId" jdbcType="INTEGER" />
    <result column="REMARK1" property="remark1" jdbcType="VARCHAR" />
    <result column="REMARK2" property="remark2" jdbcType="VARCHAR" />
    <result column="SUPERVISOR" property="supervisor" jdbcType="VARCHAR" />
    <result column="RECORDER_ID" property="recorderId" jdbcType="VARCHAR" />
    <result column="ISOVERDUE" property="isoverdue" jdbcType="INTEGER" />
    <result column="LAST_AUDIT_TIME" property="lastAuditTime" jdbcType="TIMESTAMP" />
    <result column="PR_ID" property="prId" jdbcType="VARCHAR" />
    <result column="PR_NAME" property="prName" jdbcType="VARCHAR" />
    <result column="P_ID" property="pId" jdbcType="VARCHAR" />
    <result column="P_NAME" property="pName" jdbcType="VARCHAR" />
    <result column="CU_ID" property="cuId" jdbcType="VARCHAR" />
    <result column="CU_NAME" property="cuName" jdbcType="VARCHAR" />
    <result column="MT_ID" property="mtId" jdbcType="VARCHAR" />
    <result column="MT_NAME" property="mtName" jdbcType="VARCHAR" />
    <result column="MT_CODE" property="mtCode" jdbcType="INTEGER" />
    <result column="PC_P_ID" property="pcPId" jdbcType="VARCHAR" />
    <result column="UNIT_NUMBER" property="unitNumber" jdbcType="VARCHAR" />
    <result column="YS_BACK" jdbcType="INTEGER" property="ysBack" />
    <result column="YS_PASS" jdbcType="INTEGER" property="ysPass" />
    <result column="CK_BACK" jdbcType="INTEGER" property="ckBack" />
    <result column="CK_PASS" jdbcType="INTEGER" property="ckPass" />
  </resultMap>
  
  <resultMap type="com.org.cygs.pojo.JJMission" id="jj_mission">
  		<result column="PR_ID" property="prId"/>
  		<result column="PR_NAME" property="prName"/>
  		<result column="PC_P_ID" property="pcPId"/>
  		<result column="UNIT_NUMBER" property="unitNumber"/>
  		<result column="P_ID" property="pId"/>
  		<result column="P_NAME" property="pName"/>
  		<result column="PS_ID" property="psId"/>
  		<result column="PS_NAME" property="psName"/>
  		<result column="O_ID" property="oId"/>
  		<result column="O_NAME" property="oName"/>
  		<result column="PRICE" property="price"/>
  		<result column="GCL" property="gcl"/>
  		<result column="UN_ID" property="unId"/>
  		<result column="UN_NAME" property="unName"/>
  </resultMap>
  
  	<resultMap type="com.org.cygs.pojo.MissionVo" id="missionvo">
		<result column="任务书编号" property="MCode"/>
		<result column="任务书类型" property="missionTypeName"/>
		<result column="工程名称" property="projectName"/>
		<result column="工程类别" property="projectClassName"/>
		<result column="栋号" property="dongHao"/>
		<result column="开始时间" property="beginDate"/>
		<result column="结束时间" property="endDate"/>
		<result column="结算单位" property="cuName"/>
		<result column="序号" property="xuHao"/>
		<result column="分部" property="fenBu"/>
		<result column="工程部位" property="gongChengBuWei"/>
		<result column="工作项目" property="gongZuoXiangMu"/>
		<result column="具体部位" property="juTiBuWei"/>
		<result column="工长" property="gongZhang"/>
		<result column="提交时间" property="tiJiaoShiJian"/>
		<result column="单位" property="danWei"/>
		<result column="单价" property="danJia"/>
		<result column="工程量" property="gongChengLiang"/>
		<result column="工资金额" property="gongZiJinE"/>
		<result column="已结累计工程量" property="yiJieLiang"/>
		<result column="合同材料" property="heTongCaiLiao"/>
		<result column="罚款" property="faKuan"/>
		<result column="扣款材料" property="kouKuanCaiLiao"/>
		<result column="其他" property="qiTa"/>
		<result column="最后审核时间" property="zuiHouShenHe"/>
		<result column="状态" property="zhuangTai"/>
		<result column="备注" property="remark"/>
		<result column="项目经理意见" property="xiangMuJingLi"/>
		<result column="预算意见" property="yuSuan"/>
		<result column="成控部经理意见" property="chengkong"/>
		<result column="审计意见" property="shenJi"/>
		<result column="分管领导意见" property="fenGuanLingDao"/>
		<result column="资料是否返回" property="isReturn"/>
		<result column="合计" property="HEJI"/>	
	</resultMap>
  
  

  <sql id="Column_List">
       m.M_ID,m.M_CODE,m.BEGIN_DATE,m.END_DATE,m.SUBMIT_TIME,m.STATUS,m.CU_ID,m.PR_ID,m.PC_P_ID,m.MT_ID,
       pc.UNIT_NUMBER,c.CU_NAME,pr.PR_NAME,mt.MT_NAME,m.SUPERVISOR,m.ISOVERDUE
    </sql>
    
  <sql id="Table_List">  
      [dbo].[MISSION] m,[dbo].[PR_INDEX_PC] pc,[dbo].[PROJECT] pr,[dbo].[CHECK_UNIT] c,[dbo].[MISSION_TYPE] mt
  </sql>
  
  <sql id="Table_delete_List">  
      [dbo].[MISSION_DELETE] m,[dbo].[PR_INDEX_PC] pc,[dbo].[PROJECT] pr,[dbo].[CHECK_UNIT] c,[dbo].[MISSION_TYPE] mt
  </sql>
  
  <sql id="Condition_List">
        m.CU_ID = c.CU_ID and m.PR_ID = pr.PR_ID and m.PC_P_ID = pc.PC_P_ID and m.MT_ID = mt.MT_ID
   </sql>
  
  <!-- 根据MCode查询某一任务书内容数量 -->
  <select id="selectLikedMCode" resultType="java.lang.String" parameterType="java.lang.String" >
    <!-- select M_CODE from MISSION where M_CODE like CONCAT(#{0},'%' ) order by M_CODE -->
    
    select M_CODE from MISSION where M_CODE like CONCAT(#{0},'%' ) 
	UNION
	select M_CODE from MISSION_DELETE where M_CODE like CONCAT(#{0},'%' ) order by M_CODE
  </select>
  
  <!-- 删除任务书 -->
  <select id="delMissionById" parameterType="java.lang.String"> 
    delete
    from [dbo].[MISSION]
    where
    M_ID = #{mId}      
    </select>
    
    
    <!-- 调用存储过程, 下载任务书时调用 -->
    <select id="preDownloadMission" parameterType="java.util.Map" resultMap="missionvo" statementType="CALLABLE">  
      {call listallmissionnew(#{mtId}, #{prId}, #{pcpId}, #{year}, #{month}, #{cuId}, #{status})}
  </select>
    
  
  <!-- 通过任务书id查询对应任务书 -->  
    <select id="getMIdByMcode" parameterType="java.lang.String" resultType="java.lang.String">  
        select M_ID
        from [dbo].[MISSION]
        where M_CODE = #{mCode}
    </select>
  
  
  
  
  <!-- 通过任务书id查询对应任务书 -->  
    <select id="getMissionByMId" parameterType="java.lang.String" resultMap="MissionMap">  
        select
        <include refid="Column_List" />, m.PR_ID,m.SUPERVISOR,mt.MT_CODE
        from [dbo].[MISSION] m,[dbo].[PR_INDEX_PC] pc,[dbo].[PROJECT] pr,[dbo].[CHECK_UNIT] c,[dbo].[MISSION_TYPE] mt
       <where>
        <include refid="Condition_List" /> and m.M_ID = #{mId}
	   </where>     
    </select>
    
    <!-- 通过任务书id查询对应任务书 -->  
    <select id="getMissionInfoBymId" parameterType="java.lang.String" resultMap="MissionMap"> 
    select 
    M_ID,PR_ID,BEGIN_DATE,END_DATE,M_CODE,CU_ID,SUBMIT_TIME,STATUS,REMARK,MT_ID,EDTION_ID,RECORDER_ID,P_ID,PC_P_ID,REMARK1,REMARK2,ISOVERDUE,SUPERVISOR,LAST_AUDIT_TIME   
    from [dbo].[MISSION]
    where
    M_ID = #{mId}      
    </select>
    
    
    <!-- 通过任务书id查询对应已删除任务书 -->  
    <select id="getDelMissionBymId" parameterType="java.lang.String" resultMap="MissionMap"> 
    select 
    M_ID,PR_ID,BEGIN_DATE,END_DATE,M_CODE,CU_ID,SUBMIT_TIME,STATUS,REMARK,MT_ID,EDTION_ID,RECORDER_ID,P_ID,PC_P_ID,REMARK1,REMARK2,ISOVERDUE,SUPERVISOR,LAST_AUDIT_TIME   
    from [dbo].[MISSION_DELETE]
    where
    M_ID = #{mId}      
    </select>
    
    <!-- 通过任务书id查询对应任务书 -->  
    <select id="getDMissionInfoByMId" parameterType="java.lang.String" resultMap="MissionMap">  
        select
        <include refid="Column_List" />, m.SUPERVISOR,mt.MT_CODE
        from 
       [dbo].[MISSION_DELETE] m,[dbo].[PR_INDEX_PC] pc,[dbo].[PROJECT] pr,[dbo].[CHECK_UNIT] c,[dbo].[MISSION_TYPE] mt
       <where>
        <include refid="Condition_List" /> and m.M_ID = #{mId}
	   </where>     
    </select>
    <!--恢复  先删除 已删除任务书  -->
  <delete id="delDMissionById" parameterType="java.lang.String"> 
    delete
    from [dbo].[MISSION_DELETE]
    where
    M_ID = #{mId}      
    </delete>
  
  
  
  <!-- 更新任务书审核状态 -->  
    <update id="updateMissionStatus" parameterType="com.org.cygs.pojo.Mission" >    
        update [dbo].[MISSION]    
        <set >    
          <if test="status != null" >    
            STATUS = #{status,jdbcType=INTEGER},    
          </if>   
          <if test="remark != null" >    
            REMARK = #{remark,jdbcType=VARCHAR},    
          </if>
          <if test="remark2 != null" >    
            REMARK2 = #{remark2,jdbcType=VARCHAR},    
          </if>   
          <if test="lastAuditTime != null" >    
            LAST_AUDIT_TIME = #{lastAuditTime,jdbcType=TIMESTAMP},    
          </if>     
        </set>    
        where M_ID = #{mId,jdbcType=VARCHAR}   
    </update>
  
  
  
  
  <!-- 查询相应未审核任务书 -->  
    <select id="getToAuditMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select m.M_ID, pr.PR_ID, pr.PR_NAME
        from 
        [dbo].[MISSION] m, [dbo].[PROJECT] pr
        <where>
        m.PR_ID = pr.PR_ID      
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
            and
		   <foreach collection="auditRoleList" item="Itm" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Itm.mtId} and m.STATUS = #{Itm.auditStep}-1)
           </foreach>
		</if>
		<if test="auditRoleList == null">
		and 1=2
		</if>
		<!-- 退修与工长相关 -->
		<if test="roleName != null and roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>	
	  <if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		  <foreach collection="projectList" item="Item" index="index" open="(" close=")" separator=",">
            #{Item.prId}
          </foreach>
	  </if>
	  <if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
	  
	  and m.REMARK2 = 1
		</where>
		order by pr.PR_ID     
    </select>
  
  
  <!-- 查询相应未审核任务书 -->  
    <select id="getToAuditMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        [dbo].[MISSION] m, [dbo].[PROJECT] pr
        <where>
        m.PR_ID = pr.PR_ID      
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
            and
		   <foreach collection="auditRoleList" item="Itm" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Itm.mtId} and m.STATUS = #{Itm.auditStep}-1)
           </foreach>
		 </if>
		<if test="auditRoleList == null">
		and 1=2
		</if>
		<!-- 退修与工长相关 -->
		<if test="roleName != null and roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>	
	  <if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		  <foreach collection="projectList" item="Item" index="index" open="(" close=")" separator=",">
            #{Item.prId}
          </foreach>
	  </if>
	  <if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
	  
	   and m.REMARK2 = 1
	   </where>
    </select>
  
  
  
  
    <!-- 查看任务书总记录数-->  
    <select id="getCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<if test="auditStatus ==1">
		     and m.STATUS = 100
		</if>
		<if test="auditStatus==3">
		     and m.STATUS = -1
		</if>
		<if test="auditStatus==0">
		     and (m.STATUS >= 0 and 100 > m.STATUS)
		</if>
		
		<if test="bDate!=null and bDate !=''">
		     and m.LAST_AUDIT_TIME >= #{bDate}
		</if>
		<if test="eDate!=null and eDate !=''">
		     and #{eDate} >= m.LAST_AUDIT_TIME
		</if>
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		
	  <if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		
		<!-- 复制计件任务书时的查询条件 -->
		<if test="prId != null and prId != ''">
		     and m.PR_ID = #{prId} 
		</if>
		<if test="pcPId != null and pcPId != ''">
		     and m.PC_P_ID = #{pcPId}
		</if>
		<if test="cuId != null and cuId !=''">
		     and m.CU_ID = #{cuId}
		</if>
		<if test="beginDate != null and beginDate !=''">
		     and m.BEGIN_DATE >= #{beginDate}
		</if>
		<if test="endDate != null and endDate !=''"><!-- <: 小于号会报错 -->
		     and #{endDate} >= m.END_DATE
		</if>
		
		</where>     
    </select>
    
  
  <!-- 通过筛选条件查看任务书动态选择并分页-->  
    <select id="getMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />,mt.MT_CODE
        from
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<if test="auditStatus==1">
		     and m.STATUS = 100
		</if>
		<if test="auditStatus==3">
		     and m.STATUS = -1
		</if>
		<if test="auditStatus==0">
		     and (m.STATUS >= 0 and 100 > m.STATUS)
		</if>
		
		<if test="bDate!=null and bDate !=''">
		     and m.LAST_AUDIT_TIME >= #{bDate}
		</if>
		<if test="eDate!=null and eDate !=''">
		     and #{eDate} >= m.LAST_AUDIT_TIME
		</if>
		
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		  
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		<!-- 复制计件任务书的查询条件 -->
		<if test="prId != null and prId != ''">
		     and m.PR_ID = #{prId}
		</if>
		<if test="pcPId != null and pcPId != ''">
		     and m.PC_P_ID = #{pcPId}
		</if>
		<if test="cuId != null and cuId !=''">
		     and m.CU_ID = #{cuId}
		</if>
		<if test="beginDate != null and beginDate !=''">
		     and m.BEGIN_DATE >= #{beginDate}
		</if>
		<if test="endDate != null and endDate !=''"><!-- <: 小于号会报错 -->
		     and #{endDate} >= m.END_DATE
		</if>
		
        </where>
        order by m.[SUBMIT_TIME] desc
        Offset #{offset} Row Fetch Next #{pageSize} Rows Only
    </select>
    
    
  
  <!-- 查看已提交待审核任务书总记录数-->  
    <select id="getSubmitMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
		<if test="roleName != null and roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		<if test="roleName == null">
		     and 1=2
		</if>
		<if test="auditRoleList==null">
		     and 1=2
		</if>	 
		<if test="auditRoleList !=null and auditRoleList.size() != 0">
		    and m.STATUS = 0 and m.MT_ID in
		   <foreach collection="auditRoleList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.mtId}
           </foreach>
		</if>
	</where>     
    </select>
  
   <!-- 查看已提交待审核任务书-->  
    <select id="getSubmitMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
		<if test="roleName != null and roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		<if test="roleName == null">
		     and 1=2
		</if>	 
		<if test="auditRoleList !=null and auditRoleList.size() != 0">
		    and m.STATUS = 0 and m.MT_ID in
		   <foreach collection="auditRoleList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.mtId}
           </foreach>
		</if>
        <if test="auditRoleList==null">
		     and 1=2
		</if>
	   </where>
	   order by m.[SUBMIT_TIME] desc
	   Offset #{offset} Row Fetch Next #{pageSize} Rows Only  
    </select>
    
    
    <!-- 查看未审退修任务书记录数-->  
    <select id="getUnAuditMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />       
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
            and
		   <foreach collection="auditRoleList" item="Itm" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Itm.mtId} and m.STATUS = #{Itm.auditStep}-1)
           </foreach>
		</if>
		<if test="auditRoleList==null">
		     and 1=2
		</if>
		<!-- 退修与工长相关 -->
		<if test="roleName !=null and roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>	
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		  <foreach collection="projectList" item="Item" index="index" open="(" close=")" separator=",">
            #{Item.prId}
          </foreach>
		</if>
		
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		</where>     
    </select>
    
  
   <!-- 查看未审退修任务书-->  
    <select id="getUnAuditMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />      
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
             and
		   <foreach collection="auditRoleList" item="Item" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Item.mtId} and m.STATUS = #{Item.auditStep}-1)
           </foreach>
		</if>
		<if test="auditRoleList==null">
		     and 1=2
		</if>
		<!-- 退修与工长相关 -->
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>	
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		  <foreach collection="projectList" item="Item" index="index" open="(" close=")" separator=",">
            #{Item.prId}
          </foreach>
		</if>
		
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		</where>
		order by m.[SUBMIT_TIME] desc
	    Offset #{offset} Row Fetch Next #{pageSize} Rows Only      
    </select>
    
    
    <!-- 本人已审后续未审-->  
    <select id="getAuditingMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select distinct
        <include refid="Column_List" />
        from 
        <include refid="Table_List" />,[dbo].[AUDIT_INFO] ai
       <where>
        <include refid="Condition_List" /> and ai.M_ID = m.M_ID and ai.U_ID = #{uId}
        <if test="auditRoleList==null">
		     and 1=2
		</if>  
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
             and
		   <foreach collection="auditRoleList" item="Item" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Item.mtId} and m.STATUS = #{Item.auditStep})
           </foreach>
		</if>	
	</where>
	 order by m.[SUBMIT_TIME] desc
	 Offset #{offset} Row Fetch Next #{pageSize} Rows Only  
    </select>
    
     <!-- 本人已审后续未审记录数-->  
    <select id="getAuditingMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select distinct count(m.M_ID)
        from 
        <include refid="Table_List" />,[dbo].[AUDIT_INFO] ai
        <where>
        <include refid="Condition_List" /> and ai.M_ID = m.M_ID and ai.U_ID = #{uId} 
        <if test="auditRoleList==null">
		     and 1=2
		</if> 
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
             and
		   <foreach collection="auditRoleList" item="Item" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Item.mtId} and m.STATUS = #{Item.auditStep})
           </foreach>
		</if>	
		</where>  
    </select>
    
   
   
   <!-- 查看未处理完成任务书记录数-->  
    <select id="getUnCompletedMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="prId !=null and prId !=''">
		     and pr.PR_ID =#{prId}
		</if>
		
		<if test="pcPId !=null and pcPId !=''">
		     and pc.PC_P_ID =#{pcPId}
		</if>
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	    </if>
		and m.STATUS != -1 and m.STATUS != 100
	</where>     
   </select>
    
  
  <!--查看未处理完成任务书记录-->  
    <select id="getUnCompletedMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />,mt.MT_CODE,pr.PR_ID 
        from
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="prId !=null and prId !=''">
		     and pr.PR_ID =#{prId}
		</if>
		
		<if test="pcPId !=null and pcPId !=''">
		     and pc.PC_P_ID =#{pcPId}
		</if>
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		and m.STATUS != -1 and m.STATUS != 100
	</where> 
        order by m.[SUBMIT_TIME] desc
        Offset #{offset} Row Fetch Next #{pageSize} Rows Only
    </select>
    
  
  
   <!-- 查看本人暂不处理任务书  --> 
    <select id="getStopAuditMissionList" parameterType="java.lang.String" resultMap="MissionMap">  
        select
        <include refid="Column_List" />
        from 
        <include refid="Table_List" />,[dbo].[STOP_AUDIT] sa
        where
        <include refid="Condition_List"/> and m.M_ID = sa.M_ID 
        and sa.U_ID = #{0} and sa.RO_ID = #{1}
	   order by m.[SUBMIT_TIME] desc
    </select>
    
    <!-- 查看本人暂不处理任务书 数量  --> 
    <select id="getStopAuditMissionCount" parameterType="java.lang.String" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />,[dbo].[STOP_AUDIT] sa
        where
        <include refid="Condition_List"/> and m.M_ID = sa.M_ID and sa.U_ID = #{0} and sa.RO_ID = #{1}
    </select>
  
  
  
  
  
  <!-- 查看变更签证任务书总记录数-->  
    <select id="getBGQZMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" /> 
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<!--  
		<if test="auditStatus ==1">
		     and m.STATUS = 100
		</if>
		<if test="auditStatus==3">
		     and m.STATUS = -1
		</if>
		<if test="auditStatus==0">
		     and (m.STATUS >= 0 and 100 > m.STATUS)
		</if>-->
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<!-- 
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if> -->
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		and mt.MT_CODE = 4 and m.STATUS = 100
		</where>     
    </select>
    
  
  <!-- 通过筛选条件查看变更签证任务书动态选择并分页-->  
    <select id="getBGQZMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />,mt.MT_CODE
        from
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" /> 
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<!--  
		<if test="auditStatus ==1">
		     and m.STATUS = 100
		</if>
		<if test="auditStatus==3">
		     and m.STATUS = -1
		</if>
		<if test="auditStatus==0">
		     and (m.STATUS >= 0 and 100 > m.STATUS)
		</if>-->
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<!-- 
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if> -->
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		and mt.MT_CODE = 4 and m.STATUS = 100
		</where> 
        order by m.[SUBMIT_TIME] desc
        Offset #{offset} Row Fetch Next #{pageSize} Rows Only
    </select>
  
  
  
  
  
  <!-- 查看已删除任务书总记录数-->  
    <select id="getDeleteMissionCount" parameterType="java.util.Map" resultType="java.lang.Integer">  
        select count(*)
        from 
        <include refid="Table_delete_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		 
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		
		</where>     
    </select>
    
  
  <!-- 通过筛选条件查看已删除任务书动态选择并分页-->  
    <select id="getDeleteMissionList" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />  
        from
        <include refid="Table_delete_List" />
        <where>
        <include refid="Condition_List" />
        <if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>
		<if test="mCode !=null and mCode !=''">
		     and m.M_CODE =#{mCode}
		</if>
		
		<if test="roleName.equals('工长')">
		     and m.SUPERVISOR = #{userName}
		</if>
		  
		<if test="roleName.equals('劳资员')">
		     and mt.MT_CODE = 9
		</if>
		
		<if test="roleName.equals('预算负责人')">
		     and mt.MT_CODE = 6
		</if>
		
		<if test="roleName.equals('西诺亚劳务')">
		     and c.CU_NAME = #{roleName}
		</if>
		<if test="roleName.equals('财务')">
		     and ((mt.MT_CODE = 1 and m.STATUS = 2) or (mt.MT_CODE = 3 and m.STATUS = 3) or (mt.MT_CODE = 4 and m.STATUS = 4) 
		     or (mt.MT_CODE = 5 and m.STATUS = 4) or (mt.MT_CODE = 7 and m.STATUS = 3) or (mt.MT_CODE = 8 and m.STATUS = 3))
		</if>
		
		<if test="projectList !=null and projectList.size != 0">
		    and pr.PR_ID in
		   <foreach collection="projectList" item="Item" index="index"
            open="(" close=")" separator=",">
            #{Item.prId}
           </foreach>
		</if>
		
		<if test="projectList !=null and projectList.size() == 0">
		   and 1=2
	  </if>
		
        </where>
        order by m.[SUBMIT_TIME] desc
        Offset #{offset} Row Fetch Next #{pageSize} Rows Only
    </select>
    
  <!-- 查看待审任务书  已知工程ID 逐条审核 查询-->  
    <select id="getToAuditMissionListByPrId" parameterType="java.util.Map" resultMap="MissionMap">  
        select
        <include refid="Column_List" />
        from 
        <include refid="Table_List" />
        <where>
        <include refid="Condition_List" />   
        <if test="pcPId !=null and pcPId !=''">
		     and pc.PC_P_ID =#{pcPId}
		</if>
		<if test="mtId !=null and mtId !=''">
		     and m.MT_ID =#{mtId}
		</if>  
        <if test="auditRoleList !=null and auditRoleList.size() != 0">
             and
		   <foreach collection="auditRoleList" item="Item" index="index" open="(" close=")" separator="or">
            (m.MT_ID = #{Item.mtId} and m.STATUS = #{Item.auditStep}-1)
           </foreach>
		</if>
		and pr.PR_ID = #{prId} and m.REMARK2 = 1
		<!-- 
		<if test="projectList !=null and projectList.size() != 0">
		    and pr.PR_ID in
		  <foreach collection="projectList" item="Item" index="index" open="(" close=")" separator=",">
            #{Item.prId}
          </foreach>
		</if> -->
		
		</where>
		order by m.[SUBMIT_TIME] desc         
    </select>
  
  
  
  <insert id="insertMission" parameterType="com.org.cygs.pojo.Mission" >
        insert into [dbo].[MISSION]
        <trim prefix="(" suffix=")" suffixOverrides="," >
          <if test="mId != null" >    
            M_ID,
          </if>
          <if test="prId != null" >    
            PR_ID,
          </if>    
          <if test="beginDate != null" >    
            BEGIN_DATE,    
          </if>    
          <if test="endDate != null" >    
            END_DATE,    
          </if>    
          <if test="mCode != null" >    
            M_CODE,    
          </if>  
          <if test="cuId != null" >    
            CU_ID,    
          </if> 
          <if test="submitTime != null" >    
            SUBMIT_TIME,    
          </if> 
          <if test="status != null" >    
            STATUS,    
          </if> 
          <if test="remark != null" >    
            REMARK,    
          </if> 
          <if test="mtId != null" >    
            MT_ID,    
          </if> 
          <if test="edtionId != null" >    
            EDTION_ID,    
          </if> 
          <if test="recorderId != null" >    
            RECORDER_ID,    
          </if> 
          <!-- <if test="department != null" >    
            DP_ID,    
          </if>  -->
          <if test="pId != null" >    
            P_ID,    
          </if> 
          <if test="pcPId != null" >    
            PC_P_ID,    
          </if> 
          <if test="remark1 != null" >    
            REMARK1,    
          </if> 
          <if test="remark2 != null" >    
            REMARK2,    
          </if> 
          <if test="isoverdue != null" >    
            ISOVERDUE,    
          </if> 
          <if test="supervisor != null" >    
            SUPERVISOR,    
          </if>
          <if test="lastAuditTime != null" >    
            LAST_AUDIT_TIME,    
          </if> 
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
          <if test="mId != null" >    
            #{mId, jdbcType=VARCHAR},
          </if>
          <if test="prId != null" >    
            #{prId, jdbcType=VARCHAR},
          </if>    
          <if test="beginDate != null" >    
            #{beginDate, jdbcType=TIMESTAMP},
          </if>    
          <if test="endDate != null" >    
            #{endDate, jdbcType=TIMESTAMP},
          </if>    
          <if test="mCode != null" >    
            #{mCode, jdbcType=VARCHAR},
          </if>  
          <if test="cuId != null" >    
            #{cuId, jdbcType=VARCHAR},
          </if> 
          <if test="submitTime != null" >    
            #{submitTime, jdbcType=TIMESTAMP},
          </if> 
          <if test="status != null" >    
            #{status, jdbcType=INTEGER},
          </if> 
          <if test="remark != null" >    
            #{remark, jdbcType=VARCHAR},
          </if> 
          <if test="mtId != null" >    
            #{mtId, jdbcType=VARCHAR},
          </if> 
          <if test="edtionId != null" >    
            #{edtionId, jdbcType=INTEGER},
          </if> 
          <if test="recorderId != null" >    
            #{recorderId, jdbcType=VARCHAR},
          </if> 
          <!-- <if test="department != null" >    
            #{department.dpId, jdbcType=VARCHAR},
          </if>  -->
          <if test="pId != null" >    
            #{pId, jdbcType=VARCHAR},
          </if> 
          <if test="pcPId != null" >    
            #{pcPId, jdbcType=VARCHAR},
          </if> 
          <if test="remark1 != null" >    
            #{remark1, jdbcType=VARCHAR},
          </if> 
          <if test="remark2 != null" >    
            #{remark2, jdbcType=VARCHAR},
          </if> 
          <if test="isoverdue != null" >    
            #{isoverdue, jdbcType=INTEGER},
          </if> 
          <if test="supervisor != null" >    
            #{supervisor, jdbcType=VARCHAR},
          </if>
          <if test="lastAuditTime != null" >    
            #{lastAuditTime, jdbcType=TIMESTAMP},
          </if> 
        </trim>
    </insert> 
  
  <!-- 员工工资发放汇总，获取任务书 -->
  <select id="getMissionByMap" parameterType="java.util.Map" resultMap="MissionMap">
  		select * from
  			[dbo].[MISSION] m,[dbo].[DEPARTMENT] dp,[dbo].[MISSION_TYPE] mt
  			<where>
  				m.[PR_ID] = #{prId,jdbcType=VARCHAR} and m.[DP_ID] = dp.[DP_ID] and dp.[DP_CODE] = #{dpCode,jdbcType=INTEGER} 
  				and m.[MT_ID] = mt.[MT_ID] and mt.[MT_CODE] = #{mtCode,jdbcType=INTEGER}
  				and  m.[M_ID] in 
  				<foreach collection="mIdList" item="item" index="index" open="(" close=")" separator=",">
  					#{item}
  				</foreach>
  				<if test='status == "0"'>
  					and #{maxStep,jdbcType=INTEGER} > m.[STATUS] 
  				</if>
  				<if test='status == "1"'>
  					and #{maxStep,jdbcType=INTEGER} = m.[STATUS]
  				</if>
  			
  			</where>
  </select>
  
	<update id="updateMission" parameterType="com.org.cygs.pojo.Mission">
    update MISSION
    <set>
      <if test="prId != null">
        PR_ID = #{prId,jdbcType=VARCHAR},
      </if>
      <if test="beginDate != null">
        BEGIN_DATE = #{beginDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null">
        END_DATE = #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="mCode != null">
        M_CODE = #{mCode,jdbcType=VARCHAR},
      </if>
      <if test="cuId != null">
        CU_ID = #{cuId,jdbcType=VARCHAR},
      </if>
      <if test="submitTime != null">
        SUBMIT_TIME = #{submitTime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        STATUS = #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null">
        REMARK = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="mtId != null">
        MT_ID = #{mtId,jdbcType=VARCHAR},
      </if>
      <if test="edtionId != null">
        EDTION_ID = #{edtionId,jdbcType=INTEGER},
      </if>
      <if test="recorderId != null">
        RECORDER_ID = #{recorderId,jdbcType=VARCHAR},
      </if>
      <if test="pId != null">
        P_ID = #{pId,jdbcType=VARCHAR},
      </if>
      <if test="pcPId != null">
        PC_P_ID = #{pcPId,jdbcType=VARCHAR},
      </if>
      <if test="remark1 != null">
        REMARK1 = #{remark1,jdbcType=VARCHAR},
      </if>
      <if test="remark2 != null">
        REMARK2 = #{remark2,jdbcType=VARCHAR},
      </if>
      <if test="isoverdue != null">
        ISOVERDUE = #{isoverdue,jdbcType=INTEGER},
      </if>
      <if test="supervisor != null">
        SUPERVISOR = #{supervisor,jdbcType=VARCHAR},
      </if>
      <if test="lastAuditTime != null">
        LAST_AUDIT_TIME = #{lastAuditTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where M_ID = #{mId,jdbcType=VARCHAR}
  </update>
  
  <!-- 计件任务书统计，获取工程、分部、分项、单价，单位、总工程量 -->
  <select id="getJJMissionList1" resultMap="jj_mission">
  		<!-- select pr.PR_NAME,p.P_NAME,pp.PS_NAME,o.O_NAME,mc.PRICE,un.UN_NAME,SUM(mc.REAL_QUANTITY) as GCL
  			from PROJECT pr, MISSION m,MISSION_CONTENT mc,PART p,PART_POSITION pp,OPERATION o,MISSION_TYPE mt,UNIT un
  		where pr.PR_ID = #{0} and pr.PR_ID = p.PR_ID and p.P_ID = pp.P_ID and pp.PS_ID = o.PS_ID and o.O_ID = mc.O_ID and mc.M_ID = m.M_ID and m.STATUS = #{1} and mc.UN_ID = un.UN_ID and mt.MT_ID = m.MT_ID and mt.MT_CODE = 1
  			group by PR_NAME,P_NAME,PS_NAME,O_NAME,PRICE,UN_NAME -->
  			select pr.PR_NAME,p.P_NAME,pp.PS_NAME,o.O_NAME,mc.PRICE,un.UN_NAME,SUM(mc.REAL_QUANTITY) as GCL
  			from PROJECT pr, MISSION m,MISSION_CONTENT mc,PART p,PART_POSITION pp,OPERATION o,MISSION_TYPE mt,UNIT un
  		where pr.PR_ID = #{0} and pr.PR_ID = m.PR_ID and p.P_ID = pp.P_ID and pp.PS_ID = o.PS_ID and o.O_ID = mc.O_ID and mc.M_ID = m.M_ID and m.STATUS = #{1} and mc.UN_ID = un.UN_ID and mt.MT_ID = m.MT_ID and mt.MT_CODE = 1
  			group by PR_NAME,P_NAME,PS_NAME,O_NAME,PRICE,UN_NAME
  </select>
  <!-- 计件任务书统计，获取工程、分部、分项、单价、单位，以及楼栋号下的工程量 -->
  <select id="getJJMissionList2" resultMap="jj_mission">
  		<!-- select pr.PR_NAME,p.P_NAME,pp.PS_NAME,o.O_NAME,mc.PRICE,un.UN_NAME,pip.UNIT_NUMBER,SUM(mc.REAL_QUANTITY) as GCL
  			from PROJECT pr, MISSION m,MISSION_CONTENT mc,PART p,PART_POSITION pp,OPERATION o,MISSION_TYPE mt,UNIT un,PR_INDEX_PC pip
  		where pr.PR_ID = #{0} and pr.PR_ID = pip.PR_ID and pr.PR_ID = p.PR_ID and pip.PC_P_ID = p.PC_P_ID and p.P_ID = pp.P_ID and pp.PS_ID = o.PS_ID and o.O_ID = mc.O_ID and mc.M_ID = m.M_ID and m.STATUS = #{1} and mc.UN_ID = un.UN_ID and mt.MT_ID = m.MT_ID and mt.MT_CODE = 1
  			group by PR_NAME,P_NAME,PS_NAME,O_NAME,PRICE,UN_NAME,UNIT_NUMBER
  			order by UNIT_NUMBER asc -->
  			select pr.PR_NAME,p.P_NAME,pp.PS_NAME,o.O_NAME,mc.PRICE,un.UN_NAME,pip.UNIT_NUMBER,SUM(mc.REAL_QUANTITY) as GCL
  			from PROJECT pr, MISSION m,MISSION_CONTENT mc,PART p,PART_POSITION pp,OPERATION o,MISSION_TYPE mt,UNIT un,PR_INDEX_PC pip
  		where pr.PR_ID = #{0} and pr.PR_ID = pip.PR_ID and pr.PR_ID = m.PR_ID and pip.PC_P_ID = m.PC_P_ID and p.P_ID = pp.P_ID and pp.PS_ID = o.PS_ID and o.O_ID = mc.O_ID and mc.M_ID = m.M_ID and m.STATUS = #{1} and mc.UN_ID = un.UN_ID and mt.MT_ID = m.MT_ID and mt.MT_CODE = 1
  			group by PR_NAME,P_NAME,PS_NAME,O_NAME,PRICE,UN_NAME,UNIT_NUMBER
  			order by UNIT_NUMBER asc
  </select>
</mapper>